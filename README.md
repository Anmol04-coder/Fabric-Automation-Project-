This is an excellent request. A detailed README is essential for any automation project. I have structured the description based on the provided Jupyter notebook's execution flow, technologies used, and core functionality.üìÅ README: Microsoft Fabric Workspace & Git Provisioning AutomationThis Python notebook provides a robust, end-to-end automation solution for provisioning a Microsoft Fabric Workspace and establishing its source control integration with Azure DevOps Git. The script leverages Service Principal authentication to execute a series of Fabric and Azure AD REST API calls, ensuring consistency and governance across all newly deployed environments.üéØ Project GoalTo completely automate the traditionally manual, multi-step process of setting up a new Fabric development environment by executing one single script:Securely authenticate as a Service Principal.Check for, and create, the Fabric Workspace on a designated Capacity.Assign the necessary Azure AD Group as an Admin role for governance.Create a Shareable Git Connection credential using the Service Principal.Link the Workspace to an Azure DevOps Repository and branch.Initialize the Git connection and perform the first commit of new Fabric items.üõ†Ô∏è Key Technologies & APIsComponentTechnology / API UsedPurposeWorkspace & Gitsempy.fabric.FabricRestClientCustom client wrapper for the Fabric REST APIs (e.g., /v1/workspaces, /v1/connections, /v1/git/connect).Authenticationazure.identity.ClientSecretCredentialSecurely authenticates the Service Principal using its ID and Secret.Group Lookupmsgraph-sdk (Microsoft Graph API)Used internally (or in helper functions) for querying and validating Azure AD Groups and users.Credential Storenotebookutils.mssparkutils.credentialsUsed to securely fetch sensitive credentials (Client ID, Secret, Tenant ID) from a linked Azure Key Vault.DevOps Metadatarequests with HTTPBasicAuth (using PAT)Used to fetch the internal Azure DevOps Repository ID from the DevOps REST API.EnvironmentFabric/Synapse Notebook (PySpark Kernel)Executes the Python automation code within the Fabric environment.‚öôÔ∏è Automation Workflow (Step-by-Step)The notebook is structured into logical steps to ensure the provisioning is executed reliably and idempotently.1. Configuration & Security (Cells 1-10)Install Libraries: Installs the required msgraph-sdk.Secure Credential Retrieval: Fetches client_id, client_secret, and tenant_id from a specified Azure Key Vault using mssparkutils.credentials.getSecret.Define Configuration: Sets all required parameters in a single Python dictionary (config), including the target workspaceName, fabricCapacityName, Azure DevOps details (devOpsOrgName, devOpsRepoName, devOpsBranchName), and the target adminGroups.2. API Authentication (Cells 12-15)Graph API Client: Initializes GraphServiceClient using ClientSecretCredential for potential future Azure AD calls.Fabric API Client: Defines the custom ServicePrincipalTokenProvider class to handle token renewal for the Fabric API scope, and initializes the FabricRestClient (fabric_client).3. Workspace Provisioning (Cells 17-20)Get Capacity ID: Retrieves the internal ID for the configured Fabric Capacity (e.g., "mcaps").Workspace Creation: Checks if the target workspace (AutoProject) exists using GET /v1/workspaces. If it does not exist, it creates a new one using POST /v1/workspaces and associates it with the Capacity ID. The resultant workspace_id is stored.Role Assignment: Calls POST /v1/workspaces/{workspaceId}/roleAssignments to automatically assign the Admin role to the specified Azure AD Group ID, ensuring governance is baked in from the start.4. Git Integration (Cells 21-26)Get DevOps Repo ID: Calls the Azure DevOps REST API to retrieve the unique repositoryId using the configured Personal Access Token (PAT).Create Git Connection:Checks if a shareable AzureDevOpsSourceControl connection already exists using GET /v1/connections.If no match is found, it creates a new connection using POST /v1/connections, defining the Service Principal as the credential for the Git connection. The connection_id is retrieved.Link Workspace to Git: Calls POST /v1/workspaces/{workspaceId}/git/connect using the retrieved connection_id and all Git provider details (Organization, Project, Repo, Branch, Directory) to formally link the workspace to source control.Initialize Connection: Executes POST /v1/workspaces/{workspaceId}/git/initializeConnection to ensure the link is active.First Commit:Performs a GET /v1/workspaces/{workspaceId}/git/status to find all new, untracked items (like a new Lakehouse) and retrieve the required workspaceHead.Finally, calls POST /v1/workspaces/{workspaceId}/git/commitToGit using the workspaceHead to perform the initial commit of all items to the Git repository, completing the provisioning process.üîí PrerequisitesBefore running the notebook, ensure you have configured the following:Azure Service Principal: Must be created in Azure AD with permissions to:Read Azure AD groups (Graph API: Group.Read.All).Read/Write Fabric Workspaces, Capacities, and Connections (Fabric/Power BI Service API: Tenant.ReadWrite.All).Azure Key Vault: The Service Principal credentials (client_id, client_secret, tenant_id) must be stored as secrets and the Fabric Workspace must have access to read them.Azure DevOps PAT (Optional but recommended for setup): A Personal Access Token with Code (Read) access for retrieving the internal Repository ID.Fabric Capacity: The target capacity (mcaps in the example) must exist.Azure AD Group: The security group to be assigned Admin role (Fabric_Automation in the example) must exist, and its Object ID must be used in the role assignment step.
